
                <html>
                <head>
                <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
                <title>065 Build-In Predicate Factories</title>
                </head>
                <body>
                <div class="container">
                <div class="row">
                <div class="col-md-10 col-md-offset-1">
                    <p class="lead"><h4>Built-in Route Predicate Factories in Spring Cloud API&nbsp;Gateway</h4><p>Below is a list of built-in predicates that you can use when creating routes in Spring Cloud API Gateways. These are built-in predicates and you do not need to write any additional Java code for them to work. </p><p>Note: The description of the following built-in predicates is taken from the <a href="https://cloud.spring.io/spring-cloud-gateway/reference/html/#gateway-request-predicates-factories" rel="noopener noreferrer" target="_blank">Spring Cloud API Gateway documentation page</a>.</p><p><br></p><p><strong>1. The After Route Predicate Factory</strong></p><p>The <code>After</code> route predicate factory takes one parameter, a <code>datetime</code> (which is a java <code>ZonedDateTime</code>). This predicate matches requests that happen after the specified datetime. The following example configures an after route predicate:</p><pre class="prettyprint linenums">spring.cloud.gateway.routes[0].id = after_route
spring.cloud.gateway.routes[0].uri = https://example.org
spring.cloud.gateway.routes[0].predicates[0] = After=2017-01-20T17:42:47.789-07:00[America/Denver]</pre><p>This route matches any request made after Jan 20, 2017 17:42 Mountain Time (Denver).</p><p><br></p><p><strong>2. The Before Route Predicate Factory</strong></p><p>The <code>Before</code> route predicate factory takes one parameter, a <code>datetime</code> (which is a java <code>ZonedDateTime</code>). This predicate matches requests that happen before the specified <code>datetime</code>. The following example configures a before route predicate:</p><pre class="prettyprint linenums">spring.cloud.gateway.routes[0].id = before_route
spring.cloud.gateway.routes[0].uri = https://example.org
spring.cloud.gateway.routes[0].predicates[0] = Before=2017-01-20T17:42:47.789-07:00[America/Denver]</pre><p>This route matches any request made before Jan 20, 2017 17:42 Mountain Time (Denver).</p><p><br></p><p><strong>3. The Between Route Predicate Factory</strong></p><p>The <code>Between</code> route predicate factory takes two parameters, <code>datetime1</code> and <code>datetime2</code> which are java <code>ZonedDateTime</code>objects. This predicate matches requests that happen after <code>datetime1</code> and before <code>datetime2</code>. The <code>datetime2</code> parameter must be after <code>datetime1</code>. The following example configures a between route predicate:</p><pre class="prettyprint linenums">spring.cloud.gateway.routes[0].id = between_route
spring.cloud.gateway.routes[0].uri = https://example.org
spring.cloud.gateway.routes[0].predicates[0] = Between=2017-01-20T17:42:47.789-07:00[America/Denver], 2017-01-21T17:42:47.789-07:00[America/Denver]</pre><p>This route matches any request made after Jan 20, 2017 17:42 Mountain Time (Denver) and before Jan 21, 2017 17:42 Mountain Time (Denver). This could be useful for maintenance windows.</p><p><br></p><p><strong>4. The Cookie Route Predicate Factory</strong></p><p>The <code>Cookie</code> route predicate factory takes two parameters, the cookie <code>name</code> and a <code>regexp</code> (which is a Java regular expression). This predicate matches cookies that have the given name and whose values match the regular expression. The following example configures a cookie route predicate factory:</p><pre class="prettyprint linenums">spring.cloud.gateway.routes[0].id = cookie_route
spring.cloud.gateway.routes[0].uri = https://example.org
spring.cloud.gateway.routes[0].predicates[0] = Cookie=chocolate, ch.p</pre><p>This route matches requests that have a cookie named chocolate whose value matches the ch.p regular expression.</p><p><br></p><p><strong>5. The Header Route Predicate Factory</strong></p><p>The <code>Header</code> route predicate factory takes two parameters, the header <code>name</code> and a <code>regexp</code> (which is a Java regular expression). This predicate matches with a header that has the given name whose value matches the regular expression. The following example configures a header route predicate:</p><pre class="prettyprint linenums">spring.cloud.gateway.routes[0].id = header_route
spring.cloud.gateway.routes[0].uri = https://example.org
spring.cloud.gateway.routes[0].predicates[0] = Header=X-Request-Id, \d+</pre><p>This route matches if the request has a header named <code>X-Request-Id</code> whose value matches the <code>\d+</code> regular expression (that is, it has a value of one or more digits).</p><p><br></p><p><strong>6. The Host Route Predicate Factory</strong></p><p>The <code>Host</code> route predicate factory takes one parameter: a list of host name <code>patterns</code>. The pattern is an Ant-style pattern with <code>.</code> as the separator. This predicates matches the <code>Host</code> header that matches the pattern. The following example configures a host route predicate:</p><pre class="prettyprint linenums">spring.cloud.gateway.routes[0].id = host_route
spring.cloud.gateway.routes[0].uri = https://example.org
spring.cloud.gateway.routes[0].predicates[0] = Host=**.somehost.org,**.anotherhost.org</pre><p>URI template variables (such as <code>{sub}.myhost.org</code>) are supported as well.</p><p>This route matches if the request has a <code>Host</code> header with a value of <code>www.somehost.org</code> or <code>beta.somehost.org</code> or <code>www.anotherhost.org</code>.</p><p>This predicate extracts the URI template variables (such as <code>sub</code>, defined in the preceding example) as a map of names and values and places it in the <code>ServerWebExchange.getAttributes()</code> with a key defined in <code>ServerWebExchangeUtils.URI_TEMPLATE_VARIABLES_ATTRIBUTE</code>. Those values are then available for use by <a href="https://cloud.spring.io/spring-cloud-gateway/reference/html/#gateway-route-filters" rel="noopener noreferrer" target="_blank"><code>GatewayFilter</code>factories</a><br></p><p><strong>7. The Method Route Predicate Factory</strong></p><p>The <code>Method</code> Route Predicate Factory takes a <code>methods</code> argument which is one or more parameters: the HTTP methods to match. The following example configures a method route predicate:</p><pre class="prettyprint linenums">spring.cloud.gateway.routes[0].id = method_route
spring.cloud.gateway.routes[0].uri = https://example.org
spring.cloud.gateway.routes[0].predicates[0] = Method=GET,POST</pre><p>This route matches if the request method was a <code>GET</code> or a <code>POST</code>.</p><p><strong>8. The Path Route Predicate Factory</strong></p><p>The <code>Path</code> Route Predicate Factory takes two parameters: a list of Spring <code>PathMatcher</code> <code>patterns</code> and an optional flag called <code>matchOptionalTrailingSeparator</code>. The following example configures a path route predicate:</p><pre class="prettyprint linenums">spring.cloud.gateway.routes[0].id = path_route
spring.cloud.gateway.routes[0].uri = https://example.org
spring.cloud.gateway.routes[0].predicates[0] = Path=/red/{segment},/blue/{segment}</pre><p>This route matches if the request path was, for example: <code>/red/1</code> or <code>/red/blue</code> or <code>/blue/green</code>.</p><p>This predicate extracts the URI template variables (such as <code>segment</code>, defined in the preceding example) as a map of names and values and places it in the <code>ServerWebExchange.getAttributes()</code> with a key defined in <code>ServerWebExchangeUtils.URI_TEMPLATE_VARIABLES_ATTRIBUTE</code>. Those values are then available for use by <a href="https://cloud.spring.io/spring-cloud-gateway/reference/html/#gateway-route-filters" rel="noopener noreferrer" target="_blank"><code>GatewayFilter</code>factories</a></p><p><br></p><p><strong>9. The Query Route Predicate Factory</strong></p><p>The <code>Query</code> route predicate factory takes two parameters: a required <code>param</code> and an optional <code>regexp</code> (which is a Java regular expression). The following example configures a query route predicate:</p><pre class="prettyprint linenums">spring.cloud.gateway.routes[0].id = query_route
spring.cloud.gateway.routes[0].uri = https://example.org
spring.cloud.gateway.routes[0].predicates[0] = Query=green</pre><p>The preceding route matches if the request contained a <code>green</code> query parameter.</p><p><strong>10. The RemoteAddr Route Predicate Factory</strong></p><p>The <code>RemoteAddr</code> route predicate factory takes a list (min size 1) of <code>sources</code>, which are CIDR-notation (IPv4 or IPv6) strings, such as <code>192.168.0.1/16</code> (where <code>192.168.0.1</code> is an IP address and <code>16</code> is a subnet mask). The following example configures a RemoteAddr route predicate:</p><pre class="prettyprint linenums">spring.cloud.gateway.routes[0].id = remoteaddress_route
spring.cloud.gateway.routes[0].uri = https://example.org
spring.cloud.gateway.routes[0].predicates[0] = RemoteAddr=192.168.1.1/24</pre><p>This route matches if the remote address of the request was, for example, <code>192.168.1.10</code>.</p><p><strong>11. The Weight Route Predicate Factory</strong></p><p>The <code>Weight</code> route predicate factory takes two arguments: <code>group</code> and <code>weight</code> (an int). The weights are calculated per group. The following example configures a weight route predicate:</p><pre class="prettyprint linenums">spring.cloud.gateway.routes[0].id = weight_high
spring.cloud.gateway.routes[0].uri = https://example.org
spring.cloud.gateway.routes[0].predicates[0] = Weight=group1, 8

spring.cloud.gateway.routes[1].id = weight_low
spring.cloud.gateway.routes[1].uri = https://example.org
spring.cloud.gateway.routes[1].predicates[0] = Weight=group1, 2</pre><p>This route would forward ~80% of traffic to <a href="https://weighthigh.org/" rel="noopener noreferrer" target="_blank">weighthigh.org</a> and ~20% of traffic to <a href="https://weighlow.org/" rel="noopener noreferrer" target="_blank">weighlow.org</a></p><p><br></p><p><br></p></p>
                </div>
                </div>
                </div>
                <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
                </body>
                </html>
                